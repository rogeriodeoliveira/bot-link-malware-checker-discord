require("dotenv/config");
const Discord = require("discord.js");
const scanUrl = require("./modulos/scanUrl.js");
const client = new Discord.Client();
/* const config = require("./config.json"); */

const TOKEN_DISCORD = process.env.TOKEN_DISCORD; /* || config.token_discord; */

client.on("ready", () => {
  console.log(`Logged in as ${client.user.tag}!`);
});

client.on("message", msg => {

  if (msg.author.bot) return;


  if (msg.content.includes("https://") || msg.content.includes("http://")) {
    // do not check an author's links
    // change the id value
    //if (msg.author.id == "000000000000000") return;
    msg.channel.send("ğŸ”— Link detectado!\nğŸ” Analisando link...!");
    let link = msg.content.substr(msg.content.lastIndexOf("http"));
    try {
      scanUrl(link).then(result => {
        if (result.modal == "results_modal_safe") {
          msg.channel.send("âœ…O link parece estar limpo de ameaÃ§as");
        } else if (result.modal == "results_modal_malicious") {
          msg.channel.send("âš  O Link foi identificado como sendo Suspeito!âš ");
          msg
            .delete()
            .then(
              msg.channel.send(
                "ğŸ›¡O link foi apagado por questÃµes de seguranÃ§a!"
              )
            );
          msg.reply(
            "ğŸš« Ã‰ proibido enviar links maliciosos e vocÃª estÃ¡ sujeito a puniÃ§Ãµes! âš°"
          );
        } else if (result.modal == "results_modal_fail") {
          msg.channel.send(
            "Falha ao analisar o linkâ—\nSempre tenha cuidado ao acessar links â˜ "
          );
        } else {
          msg.channel.send(
            "O Link nÃ£o pode ser analisadoâ—\nSempre tenha cuidado ao acessar links â˜ "
          );
        }
      });
    } catch (error) {
      console.log(error);
    }
  }

});

client.login(TOKEN_DISCORD);